{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="dashboard">
    <h2>V√≠tej, {{ user["email"] }}</h2>
    <p>Tvoje role: {{ ", ".join(user["roles"]) }}</p>

    <h3>üìã Tvoje kv√≠zy</h3>
    <ul>
        {% for q in quizzes %}
        <li>{{ q["title"] }}</li>
        {% else %}
        <li>≈Ω√°dn√© kv√≠zy zat√≠m nem√°≈°.</li>
        {% endfor %}
    </ul>

    <hr>
    <h3>‚ûï Vytvo≈ô nov√Ω kv√≠z</h3>
    <form id="quizForm">
        <label for="title">N√°zev kv√≠zu:</label>
        <input type="text" id="title" name="title" required>
        <button type="button" onclick="addQuestion()">P≈ôidat ot√°zku</button>
        <div id="questions"></div>
        <button type="submit">Ulo≈æit kv√≠z</button>
    </form>
</div>

<script>
let questionCount = 0;

function addQuestion() {
    const div = document.createElement("div");
    div.classList.add("question");
    div.innerHTML = `
        <h4>Ot√°zka ${++questionCount}</h4>
        <input type="text" name="question_${questionCount}_text" placeholder="Text ot√°zky" required><br>
        ${Array.from({length: 4}).map((_, i) => `
            <input type="text" name="question_${questionCount}_answer_${i}" placeholder="Odpovƒõƒè ${i+1}" required>
            <input type="radio" name="question_${questionCount}_correct" value="${i}" ${i===0?"checked":""}> spr√°vn√°<br>
        `).join("")}
        <hr>
    `;
    document.getElementById("questions").appendChild(div);
}

document.getElementById("quizForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const title = formData.get("title");

    const questions = [];
    for (let q = 1; q <= questionCount; q++) {
        const text = formData.get(`question_${q}_text`);
        const answers = [
            formData.get(`question_${q}_answer_0`),
            formData.get(`question_${q}_answer_1`),
            formData.get(`question_${q}_answer_2`),
            formData.get(`question_${q}_answer_3`)
        ];
        const correct = Number(formData.get(`question_${q}_correct`));
        questions.push({text, answers, correct_index: correct});
    }

    const res = await fetch("/quizzes/create", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({title, questions})
    });
    if (res.ok) alert("Kv√≠z ulo≈æen!");
});
</script>
{% endblock %}
